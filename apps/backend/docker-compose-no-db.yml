services:
   # Uses EXTERNAL MySQL database (not in Docker)
   backend:
      image: node:20-alpine
      restart: unless-stopped
      working_dir: /app
      extra_hosts:
         - "host.docker.internal:host-gateway"
      command: sh -c "corepack enable && corepack prepare pnpm@10.25.0 --activate && pnpm install && node ace migration:run && pnpm run dev"
      ports:
         - "${PORT:-3333}:3333"
      environment:
         TZ: ${TZ:-UTC}
         PORT: ${PORT:-3333}
         HOST: localhost
         LOG_LEVEL: ${LOG_LEVEL:-debug}
         APP_KEY: ${APP_KEY}
         NODE_ENV: development
         DB_HOST: ${DB_HOST:-host.docker.internal}
         DB_PORT: ${DB_PORT:-3306}
         DB_USER: ${DB_USER:-root}
         DB_PASSWORD: ${DB_PASSWORD:-root}
         DB_DATABASE: ${DB_DATABASE:-app}
         CLOUDINARY_CLOUD_NAME: ${CLOUDINARY_CLOUD_NAME}
         CLOUDINARY_API_KEY: ${CLOUDINARY_API_KEY}
         CLOUDINARY_API_SECRET: ${CLOUDINARY_API_SECRET}
         SESSION_DRIVER: ${SESSION_DRIVER}
         SESSION_MAX_AGE: ${SESSION_MAX_AGE}
      networks:
         - backend-network
      volumes:
         - .:/app
         - /app/node_modules
         - ./logs:/app/logs
networks:
   backend-network:
      driver: bridge
